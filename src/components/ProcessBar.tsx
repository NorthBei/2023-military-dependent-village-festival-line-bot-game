import { useMemo, useState } from 'react';
import { Tooltip } from 'react-tooltip';

import { MonsterStage } from '@/common/types';
import GiftIcon from '@/web/assets/icon-gift.svg';
import Slime from '@/web/assets/slime.svg';

const TOOLTIP_ID = 'gift-tooltip';

type ProcessBarProps = {
  status: MonsterStage;
};

function ProcessBar(props: ProcessBarProps) {
  const { status } = props;
  const [isTooltipOpen, setIsTooltipOpen] = useState<boolean>(status === MonsterStage.GiftRedeem);

  const processBarStatus = useMemo(() => {
    switch (status) {
      case MonsterStage.Init: {
        return '-3%';
      }
      case MonsterStage.Growth: {
        return '29%';
      }
      case MonsterStage.GiftRedeem: {
        return '62%';
      }
      case MonsterStage.Maternity: {
        return '93%';
      }
    }
  }, [status]);

  return (
    <div className="relative h-[41px]">
      <Tooltip
        id={TOOLTIP_ID}
        place="bottom"
        openOnClick
        style={{
          borderRadius: '100px'
        }}
        isOpen={isTooltipOpen}
        afterShow={() => {
          // close tooltip after 5s
          setTimeout(() => setIsTooltipOpen(false), 5000);
        }}
      >
        <div className="flex items-center gap-[4px]">
          <GiftIcon className="h-[16px]" />
          <span>恭喜你可以兌換禮物！</span>
        </div>
      </Tooltip>

      <Slime
        className="absolute left-[-10px] top-[-8px] h-[30px]"
        style={{
          left: processBarStatus
        }}
      />
      <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 336 41" className="h-full">
        <rect x=".5" y=".5" width="335" height="17" rx="8.5" fill="#fff" />
        <path
          d="M3.5 9A5.5 5.5 0 0 1 9 3.5h102.833v11H9A5.5 5.5 0 0 1 3.5 9Z"
          fill={
            [MonsterStage.Growth, MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '#E68169' : 'none'
          }
          stroke="#231815"
        />
        <path
          d="M113.833 3.5h108.334v11H113.833v-11Z"
          fill={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '#FFE600' : 'none'}
          stroke="#231815"
        />
        <path
          d="M224.167 3.5H327a5.5 5.5 0 0 1 0 11H224.167v-11Z"
          fill={[MonsterStage.Maternity].includes(status) ? '#00D85A' : 'none'}
          stroke="#231815"
        />
        <rect x=".5" y=".5" width="335" height="17" rx="8.5" stroke="#231815" />
        <path
          d="M45.222 26.222h2.968s-.014.546-.014.728c-.056 5.684-.112 7.686-.504 8.288-.28.462-.602.616-1.036.7-.42.084-1.036.07-1.694.056a4.11 4.11 0 0 0-.462-1.568c.56.042 1.064.042 1.33.042.182.014.308-.042.434-.238.252-.364.294-1.988.35-6.468H45.18c-.154 3.878-.7 6.72-2.8 8.554-.238-.392-.798-.994-1.148-1.246.252-.21.462-.434.658-.686l-.91.42c-.028-.168-.056-.364-.112-.546-3.528.588-4.158.756-4.564.966a10.957 10.957 0 0 0-.574-1.568c.406-.126.728-.532 1.274-1.232.35-.406 1.078-1.554 1.848-2.954-1.848.182-2.282.28-2.576.392v-.028c-.014.028-.014.042-.014.07-.084-.35-.35-1.176-.546-1.61.28-.098.518-.406.812-.938.28-.476 1.148-2.436 1.568-4.242l1.722.644a23.78 23.78 0 0 1-1.932 4.284l1.75-.112c.238-.504.462-1.008.644-1.512l1.61.714a33.362 33.362 0 0 1-3.528 5.95l2.044-.308a14.909 14.909 0 0 0-.658-1.582l1.316-.574c.518.98 1.036 2.212 1.274 3.164.91-1.498 1.176-3.472 1.246-6.02h-1.666v-1.54h1.694v-3.08h1.624c0 1.078 0 2.114-.014 3.08Zm9.758 5.418h2.422v-2.128H54.98v2.128Zm8.932 0v1.596h-4.788v2.996h-1.722v-2.996h-6.3V31.64h2.212v-3.668h4.088v-1.68h-2.996c-.574.994-1.246 1.89-1.904 2.548-.322-.28-1.036-.84-1.442-1.078 1.26-1.064 2.338-2.856 2.94-4.662l1.694.434c-.126.392-.28.77-.462 1.148h7.91v1.61h-4.018v1.68h3.696v1.54h-3.696v2.128h4.788Zm5.208-1.148v.952h1.736v-.952H69.12Zm1.736-4.242H69.12v.812h1.736v-.812Zm-1.736 2.086v.882h1.736v-.882H69.12Zm4.116 3.108V32.9h-6.874v-1.456h1.26V26.25H66.53v-1.456h1.092V23.31h1.498v1.484h1.736V23.31h1.526v1.484h.952v1.456h-.952v5.194h.854Zm-5.138 1.554 1.554.462c-.49 1.022-1.316 2.114-2.072 2.8a9.398 9.398 0 0 0-1.33-.994c.728-.546 1.456-1.428 1.848-2.268ZM75.35 30.1h2.03v-1.722h-2.016v.518c0 .364 0 .77-.014 1.204Zm2.03-4.83h-2.016v1.638h2.016V25.27Zm1.61-1.512V34.37c0 .826-.154 1.26-.644 1.526s-1.204.308-2.24.294c-.056-.434-.266-1.162-.476-1.582.602.042 1.274.028 1.47.028.21 0 .28-.07.28-.294v-2.758h-2.128c-.154 1.652-.504 3.402-1.26 4.662-.266-.294-.952-.798-1.316-.938.042-.084.098-.154.14-.238l-1.162.658c-.28-.546-.952-1.47-1.498-2.114l1.26-.686c.504.56 1.162 1.33 1.512 1.904.812-1.75.882-4.116.882-5.936v-5.138h5.18Zm188.1 3.85 1.666.406c-.574 1.82-1.4 3.444-2.408 4.802.406 1.008.854 1.596 1.302 1.596.336 0 .504-.7.574-2.45.378.392.966.756 1.414.938-.266 2.59-.826 3.206-2.128 3.206-.98 0-1.75-.7-2.366-1.848a11.866 11.866 0 0 1-2.366 1.904 10.974 10.974 0 0 0-1.204-1.372 10.695 10.695 0 0 0 2.856-2.268c-.476-1.582-.784-3.542-.966-5.642h-4.06v1.498h3.458s-.014.434-.014.63c-.042 2.94-.126 4.186-.448 4.592-.266.364-.546.49-.966.56-.364.056-.966.056-1.61.042-.028-.49-.21-1.134-.462-1.554.504.042.98.056 1.204.056.196 0 .308-.028.42-.168.14-.196.196-.868.238-2.632h-1.82c-.056 2.044-.35 4.774-1.498 6.482-.294-.322-1.036-.938-1.414-1.134 1.064-1.68 1.162-4.116 1.162-5.936v-4.088h5.712c-.028-.686-.056-1.372-.056-2.072h1.75c-.014.7 0 1.386.028 2.072h2.142c-.518-.42-1.218-.868-1.792-1.218l1.008-.994c.77.392 1.792 1.036 2.282 1.498l-.672.714h1.456v1.652h-4.326c.126 1.4.322 2.716.56 3.836a14.171 14.171 0 0 0 1.344-3.108Zm11.55-3.528v1.092h-6.482V24.08h2.632a4.743 4.743 0 0 0-.364-.756l1.512-.35c.21.336.434.756.574 1.106h2.128Zm-4.326 2.38v.658h2.282v-.658h-2.282Zm3.71 1.512h-5.068v-2.38h5.068v2.38Zm-4.242 8.176-1.568-.602c.56-.56 1.148-1.512 1.456-2.408l1.596.392c-.322.91-.882 1.96-1.484 2.618Zm2.464-4.858v.574c0 .644-.126.91-.574 1.078-.448.182-1.05.182-1.862.182-.084-.378-.28-.812-.448-1.134.49.028 1.008.028 1.162.028.168-.014.21-.042.21-.196v-.448c-.91.056-1.778.098-2.492.14l-.098-1.134c.714-.028 1.624-.07 2.59-.112v-.588h.042c.224-.084.476-.196.714-.308h-2.87v-.98h4.48l.28-.07.812.686c-.574.392-1.26.77-1.946 1.078v.098l2.17-.112-.014 1.078-2.156.14Zm-.154 2.338 1.554-.154c.182.784.322 1.806.336 2.422l-1.666.21c0-.63-.084-1.68-.224-2.478Zm2.87-.014 1.582-.252c.322.756.644 1.764.756 2.408l-1.68.322c-.084-.644-.364-1.694-.658-2.478Zm3.206-7h-.798c0 .784-.042 1.554-.196 2.338.42.322.798.658 1.078.952-.056-.882-.07-1.988-.084-3.29Zm-.798-1.4h2.31c-.042 4.214-.098 6.314.364 6.314.168 0 .224-.798.238-1.722.266.336.616.77.91.98-.112 1.512-.378 2.17-1.26 2.17-1.064 0-1.484-.882-1.652-2.688l-.7 1.12a7.493 7.493 0 0 0-.882-.896c-.406.966-1.092 1.89-2.142 2.702-.238-.322-.728-.728-1.078-.98 1.078-.84 1.68-1.778 2.016-2.744-.42-.336-.84-.63-1.246-.896l.77-1.148c.266.168.546.35.826.532.056-.462.07-.896.07-1.344h-1.176v-1.4h1.176v-2.086h1.456v2.086Zm.448 8.358 1.554-.392c.504.77 1.092 1.862 1.358 2.562l-1.68.462c-.182-.7-.742-1.806-1.232-2.632Zm8.302-3.08v.952h1.736v-.952h-1.736Zm1.736-4.242h-1.736v.812h1.736v-.812Zm-1.736 2.086v.882h1.736v-.882h-1.736Zm4.116 3.108V32.9h-6.874v-1.456h1.26V26.25h-1.092v-1.456h1.092V23.31h1.498v1.484h1.736V23.31h1.526v1.484h.952v1.456h-.952v5.194h.854Zm-5.138 1.554 1.554.462c-.49 1.022-1.316 2.114-2.072 2.8a9.398 9.398 0 0 0-1.33-.994c.728-.546 1.456-1.428 1.848-2.268Zm7.252-2.898h2.03v-1.722h-2.016v.518c0 .364 0 .77-.014 1.204Zm2.03-4.83h-2.016v1.638h2.016V25.27Zm1.61-1.512V34.37c0 .826-.154 1.26-.644 1.526s-1.204.308-2.24.294c-.056-.434-.266-1.162-.476-1.582.602.042 1.274.028 1.47.028.21 0 .28-.07.28-.294v-2.758h-2.128c-.154 1.652-.504 3.402-1.26 4.662-.266-.294-.952-.798-1.316-.938.042-.084.098-.154.14-.238l-1.162.658c-.28-.546-.952-1.47-1.498-2.114l1.26-.686c.504.56 1.162 1.33 1.512 1.904.812-1.75.882-4.116.882-5.936v-5.138h5.18Z"
          fill="#231815"
        />
        <mask id="path-7-inside-1_0_1" fill="#fff">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M225.828 21.167 224 18l-1.828 3.167C217.522 22.026 214 26.102 214 31c0 5.523 4.477 10 10 10s10-4.477 10-10c0-4.898-3.522-8.974-8.172-9.833Z"
          />
        </mask>
        <g id="gift-icon" data-tooltip-id={TOOLTIP_ID}>
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M225.828 21.167 224 18l-1.828 3.167C217.522 22.026 214 26.102 214 31c0 5.523 4.477 10 10 10s10-4.477 10-10c0-4.898-3.522-8.974-8.172-9.833Z"
            // fill="#00D85A"
            fill={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '#00D85A' : '#231815'}
            opacity={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '1' : '0.2'}
          />
          <path
            d="m224 18 .866-.5L224 16l-.866 1.5.866.5Zm1.828 3.167-.866.5.231.4.454.083.181-.983Zm-3.656 0 .181.983.454-.084.231-.4-.866-.5Zm.962-2.667 1.828 3.167 1.732-1-1.828-3.167-1.732 1Zm-.096 3.167 1.828-3.167-1.732-1-1.828 3.167 1.732 1ZM215 31a9.003 9.003 0 0 1 7.353-8.85l-.363-1.967C216.875 21.128 213 25.611 213 31h2Zm9 9a9 9 0 0 1-9-9h-2c0 6.075 4.925 11 11 11v-2Zm9-9a9 9 0 0 1-9 9v2c6.075 0 11-4.925 11-11h-2Zm-7.353-8.85A9.003 9.003 0 0 1 233 31h2c0-5.39-3.875-9.872-8.99-10.817l-.363 1.967Z"
            mask="url(#path-7-inside-1_0_1)"
            fill={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '#000' : '#231815'}
            opacity={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '1' : '0.2'}
          />
          <g clipPath="url(#clip0_0_1)">
            <path
              d="M221.495 27.227c-.176-.424-.213-.834-.041-1.253a1.53 1.53 0 0 1 .621-.739c.472-.292 1.243-.409 1.927.235a1.541 1.541 0 0 1 2.015-.175c.516.372.849 1.129.489 1.917.021.032.055.02.083.02l.642-.003 1.149.002c.283 0 .528.1.733.29.187.173.305.387.338.642.009.072.015.143.015.215.001.464.006.928-.002 1.392-.006.431-.202.758-.578.974-.012.006-.024.016-.037.018-.069.012-.083.054-.083.12l.003 3.79c0 .362-.009.723 0 1.084A1.228 1.228 0 0 1 227.546 37h-7.107a1.22 1.22 0 0 1-1.205-1.19c-.001-.519-.004-1.038-.004-1.557V30.91c-.001-.07-.013-.134-.098-.149-.368-.216-.588-.529-.594-.965a42.11 42.11 0 0 1 0-1.508c.008-.384.185-.685.509-.893a.978.978 0 0 1 .575-.166l1.766.002c.03 0 .06-.003.106-.005h.001Zm2.94 8.902c.022.003.036.006.049.006h3.065a.328.328 0 0 0 .344-.295c.009-.06.009-.122.009-.183v-4.656l-.001-.058c-.002-.039-.018-.061-.061-.062-.077-.001-.155-.009-.233-.01l-.783-.001c-.767 0-1.533 0-2.299.002-.091 0-.095.004-.094.093v.058l.002 5.014v.092h.002Zm-4.331-5.255c-.002.034-.006.056-.006.077v4.59c0 .097.002.194.004.291a.273.273 0 0 0 .055.154c.077.105.181.15.309.15h3.095c.003-.035.006-.063.006-.09v-4.973c0-.038 0-.077-.002-.116-.002-.065-.008-.073-.071-.075-.161-.004-.322-.011-.483-.012h-2.249c-.216 0-.432.002-.659.004h.001Zm3.453-.854c.004-.036.01-.063.01-.09 0-.566 0-1.132-.002-1.699 0-.127.026-.13-.132-.13l-3.698-.002c-.045 0-.09-.004-.133.004a.355.355 0 0 0-.122.043c-.064.041-.081.107-.081.181.002.475.001.95.001 1.425l.001.058a.198.198 0 0 0 .116.17.46.46 0 0 0 .21.037l3.64.002h.19Zm.88-1.906v1.89c.021.005.039.012.057.013.078.002.155.003.233.003h3.441c.056 0 .112.001.167-.003.192-.015.267-.097.267-.289v-1.34a.556.556 0 0 0-.006-.092c-.018-.107-.106-.203-.231-.195-.063.004-.128-.002-.191-.002h-2.566c-.347 0-.694.002-1.041.004-.042 0-.082.007-.129.01h-.001Zm.008-.89c.04.001.081.005.121.004.208-.002.416.005.623-.01a.676.676 0 0 0 .555-.947c-.158-.373-.701-.558-1.074-.246a.603.603 0 0 0-.235.49c.004.22.001.439.002.658 0 .014.004.027.008.05Zm-1.29 0v.006h.334c.068 0 .075-.009.076-.079 0-.194.002-.388-.002-.582a.91.91 0 0 0-.025-.222.603.603 0 0 0-.175-.28.672.672 0 0 0-.571-.194.705.705 0 0 0-.594.696.685.685 0 0 0 .617.654c.112.01.227.002.341.002l-.001-.001Z"
              // fill="#231815"
              fill={[MonsterStage.GiftRedeem, MonsterStage.Maternity].includes(status) ? '#231815' : '#FFFFFF'}
            />
          </g>
        </g>
        <path
          d="m157.09 27.608 1.666.406c-.574 1.82-1.4 3.444-2.408 4.802.406 1.008.854 1.596 1.302 1.596.336 0 .504-.7.574-2.45.378.392.966.756 1.414.938-.266 2.59-.826 3.206-2.128 3.206-.98 0-1.75-.7-2.366-1.848a11.866 11.866 0 0 1-2.366 1.904 10.974 10.974 0 0 0-1.204-1.372 10.695 10.695 0 0 0 2.856-2.268c-.476-1.582-.784-3.542-.966-5.642h-4.06v1.498h3.458s-.014.434-.014.63c-.042 2.94-.126 4.186-.448 4.592-.266.364-.546.49-.966.56-.364.056-.966.056-1.61.042-.028-.49-.21-1.134-.462-1.554.504.042.98.056 1.204.056.196 0 .308-.028.42-.168.14-.196.196-.868.238-2.632h-1.82c-.056 2.044-.35 4.774-1.498 6.482-.294-.322-1.036-.938-1.414-1.134 1.064-1.68 1.162-4.116 1.162-5.936v-4.088h5.712a50.487 50.487 0 0 1-.056-2.072h1.75c-.014.7 0 1.386.028 2.072h2.142c-.518-.42-1.218-.868-1.792-1.218l1.008-.994c.77.392 1.792 1.036 2.282 1.498l-.672.714h1.456v1.652h-4.326c.126 1.4.322 2.716.56 3.836a14.171 14.171 0 0 0 1.344-3.108Zm15.736 3.668h-3.192c.308.532.686.994 1.134 1.414.714-.434 1.498-.952 2.058-1.414Zm.49 0 1.078.742a21.82 21.82 0 0 1-2.464 1.54c.882.532 1.932.91 3.192 1.148-.364.336-.826 1.036-1.05 1.484-3.122-.714-4.998-2.338-6.188-4.914h-2.002v2.968l3.066-.616a9.937 9.937 0 0 0-.14 1.484c-3.346.742-4.116.924-4.494 1.092l-.084.07c-.112-.392-.434-1.26-.7-1.652.308-.168.714-.504.714-1.078v-2.268H162.2v-1.47h2.324v-6.188h8.834v1.358h-7.126v.77h6.734v1.288h-6.734v.728h6.734v1.288h-6.734v.756h8.596v1.47h-1.512Zm6.804-.784v.952h1.736v-.952h-1.736Zm1.736-4.242h-1.736v.812h1.736v-.812Zm-1.736 2.086v.882h1.736v-.882h-1.736Zm4.116 3.108V32.9h-6.874v-1.456h1.26V26.25h-1.092v-1.456h1.092V23.31h1.498v1.484h1.736V23.31h1.526v1.484h.952v1.456h-.952v5.194h.854Zm-5.138 1.554 1.554.462c-.49 1.022-1.316 2.114-2.072 2.8a9.398 9.398 0 0 0-1.33-.994c.728-.546 1.456-1.428 1.848-2.268Zm7.252-2.898h2.03v-1.722h-2.016v.518c0 .364 0 .77-.014 1.204Zm2.03-4.83h-2.016v1.638h2.016V25.27Zm1.61-1.512V34.37c0 .826-.154 1.26-.644 1.526s-1.204.308-2.24.294c-.056-.434-.266-1.162-.476-1.582.602.042 1.274.028 1.47.028.21 0 .28-.07.28-.294v-2.758h-2.128c-.154 1.652-.504 3.402-1.26 4.662-.266-.294-.952-.798-1.316-.938.042-.084.098-.154.14-.238l-1.162.658c-.28-.546-.952-1.47-1.498-2.114l1.26-.686c.504.56 1.162 1.33 1.512 1.904.812-1.75.882-4.116.882-5.936v-5.138h5.18Z"
          fill="#231815"
        />
        <defs>
          <clipPath id="clip0_0_1">
            <path fill="#fff" transform="translate(218.532 25)" d="M0 0h10.937v12H0z" />
          </clipPath>
        </defs>
      </svg>
    </div>
  );
}

export default ProcessBar;
